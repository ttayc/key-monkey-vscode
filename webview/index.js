var I=Object.defineProperty;var M=(s,e,t)=>e in s?I(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var d=(s,e,t)=>M(s,typeof e!="symbol"?e+"":e,t);const S=document.getElementById("test-wrapper"),$=document.getElementById("input-wrapper"),u=document.getElementById("user-text"),q=document.getElementById("start-text"),w=document.getElementById("results"),n=[];let r=0,T=-1,C=!1,y;class z{constructor(e,t){d(this,"wordDomElem");d(this,"testText");d(this,"userText");d(this,"trailingSpace");this.testText=e,this.userText="",this.wordDomElem=t;for(let a=0;a<e.length;a++){const c=document.createElement("span");c.classList.add("char","blank"),c.innerText=e[a],t.appendChild(c)}const o=document.createElement("span");o.classList.add("char","blank"),o.innerText=" ",this.trailingSpace=o,t.appendChild(o)}setCursor(){var e;(e=this.wordDomElem.children.item(this.userText.length))==null||e.classList.add("cursor")}setColors(){for(let e=0;e<this.wordDomElem.children.length;e++){const t=this.wordDomElem.children.item(e);if(!t)break;if(e>=this.userText.length){t.classList.add("blank"),t.classList.remove("correct","incorrect","excess");continue}if(e>=this.testText.length){t.classList.add("excess"),t.classList.remove("correct","incorrect","blank");continue}this.userText[e]===t.innerText?(t.classList.add("correct"),t.classList.remove("blank","incorrect","excess")):(t.classList.add("incorrect"),t.classList.remove("blank","correct","excess"))}}writeChar(e){this.userText=this.userText.concat(e),this.userText.length>this.testText.length&&n[r].addExcessChar(e)}backspace(){this.userText!==""&&(this.userText.length>this.testText.length&&n[r].removeExcessChar(),this.userText=this.userText.slice(0,-1))}isComplete(){return this.userText===this.testText}wordStats(){let[e,t,o,a]=[0,0,0,0],c=0;for(;c<this.userText.length;c++)c>=this.testText.length&&o++,this.userText[c]===this.testText[c]?e++:t++;for(;c<this.testText.length;c++)a++;return[e,t,o,a]}addExcessChar(e){const t=document.createElement("span");t.classList.add("char","blank"),t.innerText=e,this.wordDomElem.insertBefore(t,this.wordDomElem.lastChild)}removeExcessChar(){var e,t;(t=(e=this.wordDomElem.lastChild)==null?void 0:e.previousSibling)==null||t.remove()}}const L=function(){const s=document.querySelector(".cursor");s&&s.classList.remove("cursor")},f=function(){L(),n[r].setCursor()},R=function(){n.forEach(s=>s.setColors())},E=function(){const s=Date.now()-y,e=_(n,s);document.getElementById("wpm").innerText=`${Math.round(e.wpm)}`,document.getElementById("accuracy").innerText=`${Math.round(e.accuracy*100)}%`,document.getElementById("raw-wpm").innerText=`${Math.round(e.rawWpm)}`,w.classList.remove("hidden"),S.classList.add("hidden")},g=function(){const s=document.getElementById("word-count");s.innerText=`${r}/${n.length}`},_=function(s,e){const t=s.filter(i=>i.isComplete()),o=t.reduce((i,l)=>i+l.userText.length,0)+t.length-1,a=s.reduce((i,l)=>i+l.userText.length,0)+s.length-1,c=e/1e3/60,k=o/5/c,v=a/5/c;let[h,m,p,x]=[0,0,0,0];s.forEach(i=>{const[l,D,W,B]=i.wordStats();h+=l,m+=D,p+=W,x+=B});const b=h/(h+m+p+x);return{elapsedMs:e,wpm:Math.max(k,0),rawWpm:Math.max(v,0),accuracy:Math.max(b,0),correctChars:h,incorrectChars:m,excessChars:p,missingChars:x}};u.addEventListener("keydown",s=>{const e=s,t=e.key;if(t.includes("Arrow")||t==="Delete")return s.preventDefault(),!1;if(t==="Backspace"&&r-1>T&&n[r].userText==="")return r-=1,e.target.value=n[r].userText,f(),g(),s.preventDefault(),!1});const j=function(s){if(s.inputType==="deleteContentBackward"){n[r].backspace();return}const e=s.data;e&&(e!==" "?(C||(y=Date.now(),C=!0),n[r].writeChar(e),r===n.length-1&&n[r].isComplete()&&E()):(r===n.length-1&&E(),n[r].isComplete()&&r-1===T&&(T+=1),n[r].userText!==""&&(r+=1),s.target.value=""))};u.addEventListener("input",s=>{j(s),f(),R(),g()});u.addEventListener("blur",s=>{L()});$.addEventListener("click",s=>{u.focus(),f()});function A(s){w.classList.add("hidden"),s.forEach(e=>{const t=document.createElement("span");t.classList.add("word");const o=new z(e,t);n.push(o),q.appendChild(t)}),g(),u.focus()}const F=["the","quick","brown","fox","jumps","over","the","lazy","dog"];A(F);
